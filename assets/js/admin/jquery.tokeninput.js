!function(t){function e(t){return String(null===t||void 0===t?"":t)}function n(t){return e(t).replace(d,function(t){return l[t]})}var a={method:"GET",queryParam:"q",searchDelay:1500,minChars:1,propertyToSearch:"name",iconUrl:"icon",jsonContainer:null,contentType:"json",prePopulate:null,processPrePopulate:!1,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:!0,placeholder:null,theme:null,zindex:999,resultsLimit:null,enableHTML:!1,resultsFormatter:function(t){var e=t[this.propertyToSearch],a=t[this.iconUrl];return"<li>"+(a?'<img width="75px" src="'+a+'" />':"")+(this.enableHTML?e:n(e))+"</li>"},tokenFormatter:function(t){var e=t[this.propertyToSearch];return"<li><p>"+(this.enableHTML?e:n(e))+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",allowFreeTagging:!1,allowTabOut:!1,onResult:null,onCachedResult:null,onAdd:null,onFreeTaggingAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:!1},s={tokenList:"token-input-list",token:"token-input-token",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"},i={BEFORE:0,AFTER:1,END:2},o={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},d=/[&<>"'\/]/g,r={init:function(e,n){var s=t.extend({},a,n||{});return this.each(function(){t(this).data("settings",s),t(this).data("tokenInputObject",new t.TokenList(this,e,s))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(t){return this.data("tokenInputObject").add(t),this},remove:function(t){return this.data("tokenInputObject").remove(t),this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(t){return this.data("tokenInputObject").toggleDisabled(t),this},setOptions:function(e){return t(this).data("settings",t.extend({},t(this).data("settings"),e||{})),this},destroy:function(){if(this.data("tokenInputObject")){this.data("tokenInputObject").clear();var t=this,e=this.parent();return e.empty(),t.show(),e.append(t),t}}};t.fn.tokenInput=function(t){return r[t]?r[t].apply(this,Array.prototype.slice.call(arguments,1)):r.init.apply(this,arguments)},t.TokenList=function(e,a,l){function d(a){return t(e).data("settings").enableHTML?a:n(a)}function r(n){"boolean"==typeof n?t(e).data("settings").disabled=n:t(e).data("settings").disabled=!t(e).data("settings").disabled,U.attr("disabled",t(e).data("settings").disabled),V.toggleClass(t(e).data("settings").classes.disabled,t(e).data("settings").disabled),z&&k(t(z),i.END),_.attr("disabled",t(e).data("settings").disabled)}function u(){if(null!==t(e).data("settings").tokenLimit&&H>=t(e).data("settings").tokenLimit)return U.hide(),void y()}function c(){if(N!==(N=U.val())){var t=V.width()-U.offset().left-V.offset().left;$.html(n(N)||n(l.placeholder)),U.width(Math.min(V.width(),Math.max(t,$.width()+30)))}}function g(){var n=t.trim(U.val()),a=n.split(t(e).data("settings").tokenDelimiter);t.each(a,function(n,a){if(a){t.isFunction(t(e).data("settings").onFreeTaggingAdd)&&(a=t(e).data("settings").onFreeTaggingAdd.call(_,a));var s={};s[t(e).data("settings").tokenValue]=s[t(e).data("settings").propertyToSearch]=a,h(s)}})}function p(n){var a=t(t(e).data("settings").tokenFormatter(n)),s=n.readonly===!0;s&&a.addClass(t(e).data("settings").classes.tokenReadOnly),a.addClass(t(e).data("settings").classes.token).insertBefore(q),s||t("<span>"+t(e).data("settings").deleteText+"</span>").addClass(t(e).data("settings").classes.tokenDelete).appendTo(a).click(function(){if(!t(e).data("settings").disabled)return T(t(this).parent()),_.change(),!1});var i=n;return t.data(a.get(0),"tokeninput",n),M=M.slice(0,G).concat([i]).concat(M.slice(G)),G++,v(M,_),H+=1,null!==t(e).data("settings").tokenLimit&&H>=t(e).data("settings").tokenLimit&&(U.hide(),y()),a}function h(n){var a=t(e).data("settings").onAdd;if(H>0&&t(e).data("settings").preventDuplicates){var s=null;if(V.children().each(function(){var e=t(this),a=t.data(e.get(0),"tokeninput");if(a&&a[l.tokenValue]===n[l.tokenValue])return s=e,!1}),s)return f(s),q.insertAfter(s),void I(U)}U.width(0),(null==t(e).data("settings").tokenLimit||H<t(e).data("settings").tokenLimit)&&(p(n),U.attr("placeholder",null),u()),U.val(""),y(),t.isFunction(a)&&a.call(_,n)}function f(n){t(e).data("settings").disabled||(n.addClass(t(e).data("settings").classes.selectedToken),z=n.get(0),U.val(""),y())}function k(n,a){n.removeClass(t(e).data("settings").classes.selectedToken),z=null,a===i.BEFORE?(q.insertBefore(n),G--):a===i.AFTER?(q.insertAfter(n),G++):(q.appendTo(V),G=H),I(U)}function m(e){var n=z;z&&k(t(z),i.END),n===e.get(0)?k(e,i.END):f(e)}function T(n){var a=t.data(n.get(0),"tokeninput"),s=t(e).data("settings").onDelete,i=n.prevAll().length;i>G&&i--,n.remove(),z=null,I(U),M=M.slice(0,i).concat(M.slice(i+1)),0==M.length&&U.attr("placeholder",l.placeholder),i<G&&G--,v(M,_),H-=1,null!==t(e).data("settings").tokenLimit&&(U.show().val(""),I(U)),t.isFunction(s)&&s.call(_,a)}function v(n,a){var s=t.map(n,function(n){return"function"==typeof t(e).data("settings").tokenValue?t(e).data("settings").tokenValue.call(this,n):n[t(e).data("settings").tokenValue]});a.val(s.join(t(e).data("settings").tokenDelimiter))}function y(){K.hide().empty(),W=null}function C(){K.css({position:"absolute",top:V.offset().top+V.outerHeight(),left:V.offset().left,width:V.width(),"z-index":t(e).data("settings").zindex}).show()}function w(){t(e).data("settings").searchingText&&(K.html("<p>"+d(t(e).data("settings").searchingText)+"</p>"),C())}function b(){t(e).data("settings").hintText&&(K.html("<p>"+d(t(e).data("settings").hintText)+"</p>"),C())}function E(t){return t.replace(J,"\\$&")}function D(t,e){return t.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+E(e)+")(?![^<>]*>)(?![^&;]+;)","gi"),function(t,e){return"<b>"+d(e)+"</b>"})}function R(t,e,n){return t.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+E(e)+")(?![^<>]*>)(?![^&;]+;)","g"),D(e,n))}function x(n,a){if(a&&a.length){K.empty();var s=t("<ul>").appendTo(K).mouseover(function(e){F(t(e.target).closest("li"))}).mousedown(function(e){return h(t(e.target).closest("li").data("tokeninput")),_.change(),!1}).hide();t(e).data("settings").resultsLimit&&a.length>t(e).data("settings").resultsLimit&&(a=a.slice(0,t(e).data("settings").resultsLimit)),t.each(a,function(a,i){var o=t(e).data("settings").resultsFormatter(i);o=R(o,i[t(e).data("settings").propertyToSearch],n),o=t(o).appendTo(s),a%2?o.addClass(t(e).data("settings").classes.dropdownItem):o.addClass(t(e).data("settings").classes.dropdownItem2),0===a&&F(o),t.data(o.get(0),"tokeninput",i)}),C(),t(e).data("settings").animateDropdown?s.slideDown("fast"):s.show()}else t(e).data("settings").noResultsText&&(K.html("<p>"+d(t(e).data("settings").noResultsText)+"</p>"),C())}function F(n){n&&(W&&L(t(W)),n.addClass(t(e).data("settings").classes.selectedDropdownItem),W=n.get(0))}function L(n){n.removeClass(t(e).data("settings").classes.selectedDropdownItem),W=null}function A(){var n=U.val();n&&n.length&&(z&&k(t(z),i.AFTER),n.length>=t(e).data("settings").minChars?(w(),clearTimeout(j),j=setTimeout(function(){O(n)},t(e).data("settings").searchDelay)):y())}function O(n){var a=n+P(),s=B.get(a);if(s)t.isFunction(t(e).data("settings").onCachedResult)&&(s=t(e).data("settings").onCachedResult.call(_,s)),x(n,s);else if(t(e).data("settings").url){var i=P(),o={};if(o.data={},i.indexOf("?")>-1){var d=i.split("?");o.url=d[0];var r=d[1].split("&");t.each(r,function(t,e){var n=e.split("=");o.data[n[0]]=n[1]})}else o.url=i;o.data[t(e).data("settings").queryParam]=n,o.type=t(e).data("settings").method,o.dataType=t(e).data("settings").contentType,t(e).data("settings").crossDomain&&(o.dataType="jsonp"),o.success=function(s){B.add(a,t(e).data("settings").jsonContainer?s[t(e).data("settings").jsonContainer]:s),t.isFunction(t(e).data("settings").onResult)&&(s=t(e).data("settings").onResult.call(_,s)),U.val()===n&&x(n,t(e).data("settings").jsonContainer?s[t(e).data("settings").jsonContainer]:s)},l.onSend&&l.onSend(o),t.ajax(o)}else if(t(e).data("settings").local_data){var u=t.grep(t(e).data("settings").local_data,function(a){return a[t(e).data("settings").propertyToSearch].toLowerCase().indexOf(n.toLowerCase())>-1});B.add(a,u),t.isFunction(t(e).data("settings").onResult)&&(u=t(e).data("settings").onResult.call(_,u)),x(n,u)}}function P(){var n=t(e).data("settings").url;return"function"==typeof t(e).data("settings").url&&(n=t(e).data("settings").url.call(t(e).data("settings"))),n}function I(t){setTimeout(function(){t.focus()},50)}if("string"===t.type(a)||"function"===t.type(a)){t(e).data("settings").url=a;var S=P();void 0===t(e).data("settings").crossDomain&&"string"==typeof S&&(S.indexOf("://")===-1?t(e).data("settings").crossDomain=!1:t(e).data("settings").crossDomain=location.href.split(/\/+/g)[1]!==S.split(/\/+/g)[1])}else"object"==typeof a&&(t(e).data("settings").local_data=a);t(e).data("settings").classes?t(e).data("settings").classes=t.extend({},s,t(e).data("settings").classes):t(e).data("settings").theme?(t(e).data("settings").classes={},t.each(s,function(n,a){t(e).data("settings").classes[n]=a+"-"+t(e).data("settings").theme})):t(e).data("settings").classes=s;var j,N,M=[],H=0,B=new t.TokenList.Cache,U=t('<input type="text"  autocomplete="off" autocapitalize="off">').css({outline:"none"}).attr("id",t(e).data("settings").idPrefix+e.id).focus(function(){return!t(e).data("settings").disabled&&(null!==t(e).data("settings").tokenLimit&&t(e).data("settings").tokenLimit===H||b(),void V.addClass(t(e).data("settings").classes.focused))}).blur(function(){y(),t(e).data("settings").allowFreeTagging&&g(),t(this).val(""),V.removeClass(t(e).data("settings").classes.focused)}).bind("keyup keydown blur update",c).keyup(function(t){switch(t.keyCode){case o.LEFT:case o.RIGHT:case o.UP:case o.DOWN:break;default:setTimeout(function(){A()},5)}}).keydown(function(n){var a,s;switch(n.keyCode){case o.LEFT:case o.RIGHT:case o.UP:case o.DOWN:if(t(this).val()){var l=null;l=n.keyCode===o.DOWN||n.keyCode===o.RIGHT?t(W).next():t(W).prev(),l.length&&F(l)}else a=q.prev(),s=q.next(),a.length&&a.get(0)===z||s.length&&s.get(0)===z?n.keyCode===o.LEFT||n.keyCode===o.UP?k(t(z),i.BEFORE):k(t(z),i.AFTER):n.keyCode!==o.LEFT&&n.keyCode!==o.UP||!a.length?n.keyCode!==o.RIGHT&&n.keyCode!==o.DOWN||!s.length||f(t(s.get(0))):f(t(a.get(0)));return!1;case o.BACKSPACE:if(a=q.prev(),!t(this).val().length)return z?(T(t(z)),_.change()):a.length&&f(t(a.get(0))),!1;1===t(this).val().length?y():setTimeout(function(){A()},5);break;case o.TAB:case o.ENTER:case o.NUMPAD_ENTER:case o.COMMA:if(W)h(t(W).data("tokeninput")),_.change();else{if(t(e).data("settings").allowFreeTagging){if(t(e).data("settings").allowTabOut&&""===t(this).val())return!0;g()}else if(t(this).val(""),t(e).data("settings").allowTabOut)return!0;n.stopPropagation(),n.preventDefault()}return!1;case o.ESCAPE:return y(),!0;default:String.fromCharCode(n.which)&&setTimeout(function(){A()},5)}});l.placeholder&&U.attr("placeholder",l.placeholder);var _=t(e).hide().val("").focus(function(){I(U)}).blur(function(){return U.blur(),_}),z=null,G=0,W=null,V=t("<ul />").addClass(t(e).data("settings").classes.tokenList).click(function(e){var n=t(e.target).closest("li");n&&n.get(0)&&t.data(n.get(0),"tokeninput")?m(n):(z&&k(t(z),i.END),I(U))}).mouseover(function(n){var a=t(n.target).closest("li");a&&z!==this&&a.addClass(t(e).data("settings").classes.highlightedToken)}).mouseout(function(n){var a=t(n.target).closest("li");a&&z!==this&&a.removeClass(t(e).data("settings").classes.highlightedToken)}).insertBefore(_),q=t("<li />").addClass(t(e).data("settings").classes.inputToken).appendTo(V).append(U),K=t("<div>").addClass(t(e).data("settings").classes.dropdown).appendTo("body").hide(),$=t("<tester/>").insertAfter(U).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:U.css("fontSize"),fontFamily:U.css("fontFamily"),fontWeight:U.css("fontWeight"),letterSpacing:U.css("letterSpacing"),whiteSpace:"nowrap"});_.val("");var Q=t(e).data("settings").prePopulate||_.data("pre");t(e).data("settings").processPrePopulate&&t.isFunction(t(e).data("settings").onResult)&&(Q=t(e).data("settings").onResult.call(_,Q)),Q&&Q.length&&t.each(Q,function(t,e){p(e),u(),U.attr("placeholder",null)}),t(e).data("settings").disabled&&r(!0),t.isFunction(t(e).data("settings").onReady)&&t(e).data("settings").onReady.call(),this.clear=function(){V.children("li").each(function(){0===t(this).children("input").length&&T(t(this))})},this.add=function(t){h(t)},this.remove=function(e){V.children("li").each(function(){if(0===t(this).children("input").length){var n=t(this).data("tokeninput"),a=!0;for(var s in e)if(e[s]!==n[s]){a=!1;break}a&&T(t(this))}})},this.getTokens=function(){return M},this.toggleDisabled=function(t){r(t)},c();var J=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g")},t.TokenList.Cache=function(e){var n=t.extend({max_size:500},e),a={},s=0,i=function(){a={},s=0};this.add=function(t,e){s>n.max_size&&i(),a[t]||(s+=1),a[t]=e},this.get=function(t){return a[t]}}}(jQuery);