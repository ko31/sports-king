!function(e){e(document).ready(function(){e("#pickup-editor-link").submit(function(t){t.preventDefault();var i=parseInt(e(this).find("select").val(),10)-1;e(".pickup-editor__line:nth("+i+")").append(e(this).find(".pickup-editor__template").html()).effect("highlight",{},500)});var t=e("#pickup-editor-search");t.autocomplete({source:t.attr("data-action"),delay:1500,focus:function(){return!1},select:function(i,n){var a=parseInt(t.prevAll("select").val(),10)-1;e(".pickup-editor__line:nth("+a+")").append(n.item.template).effect("highlight",{},500)}}).autocomplete("instance")._renderItem=function(t,i){return e("<li>").append("<a>"+i.name+"</a>").appendTo(t)},e(".pickup-editor").on("click",".button-delete",function(t){t.preventDefault(),e(this).parents(".pickup-editor__line").effect("highlight",{},500),e(this).parents(".pickup-editor__wrap").remove()}),e(".pickup-editor").on("click",".moveLeft, .moveRight",function(t){t.preventDefault();var i=e(this).parents(".pickup-editor__wrap");e(this).hasClass("moveLeft")?i.prev(".pickup-editor__wrap").before(i):i.next(".pickup-editor__wrap").after(i),i.parent(".pickup-editor__line").effect("highlight",{},500)}),e(".pickup-editor").on("click",".moveUp, .moveDown",function(t){t.preventDefault();var i=e(this).parents(".pickup-editor__wrap"),n=i.parents(".pickup-editor__line");e(this).hasClass("moveUp")?n.prev().append(i).effect("highlight",{},500):n.next().append(i).effect("highlight",{},500)}),e("#pickup-submit").click(function(t){if(t.preventDefault(),e(this).attr("disabled"))return!1;if(window.confirm("保存してよろしいですか？ この変更はすぐに反映されます。")){var i=[],n=[];if(e(".pickup-editor__line").each(function(t,a){var p=[];e(a).find(".pickup-editor__wrap").each(function(i,a){switch(e(a).attr("data-type")){case"broken":return n.push("無効な情報が含まれています。削除してください。"),!1;case"post":p.push(e(a).find("input").val());break;case"link":var r={};e(a).find(".pickup-editor__input").each(function(a,p){var c=e(p).val(),o=e(p).attr("name");return"image"==o||"image_id"==o||c&&c.length?void(r[e(p).attr("name")]=c):(n.push(t+1+"列"+(i+1)+"番目のリンク情報が無効です。タイトル、URLが必要です。"),!1)}),r.external=!!e(a).find("input:checked").length,p.push(r)}}),i.push(p)}),n.length)window.alert(n.join("\n"));else{var a=e(this);e(this).attr("disabled",!0),e.post(e(this).attr("data-endpoint"),{data:i}).done(function(e){window.alert(e.message)}).fail(function(e){window.alert(e.responseJSON?e.responseJSON.message:"保存に失敗しました。")}).always(function(){a.attr("disabled",!1)})}}})})}(jQuery);